!function(){"use strict";angular.module("musicSearch",["musicSearch.constants","musicSearch.services.localStorage","musicSearch.services.helper","musicSearch.services.search","musicSearch.directive.contentCard","musicSearch.directive.modalBox","musicSearch.controller.main","musicSearch.controller.search"])}(),function(){"use strict";angular.module("musicSearch.constants",[]).constant("Constants",{APIURL:"https://api.spotify.com/",Search:"v1/search",AlbumById:"v1/albums/",ArtistById:"v1/artists/"})}(),function(){"use strict";angular.module("musicSearch.services.helper",[]).service("Helper",[function(){this.shuffleArray=function(e,t){var c,n=Math.min(e.length,t.length),r=Math.max(e.length,t.length)-n,o=[];for(c=0;c<n;c++)o.push(e[c]),o.push(t[c]);for(c=0;c<r;c++)e.length>t.length?o.push(e[c+n]):o.push(t[c+n]);return o}}])}(),function(){"use strict";angular.module("musicSearch.services.localStorage",[]).service("LocalStorage",[function(){var e=this;e.getLocalStorage=function(){var e=localStorage.getItem("musicSearch.recentSearch");return null===e?[]:JSON.parse(e)},e.deleteLocalStorage=function(){delete localStorage["musicSearch.recentSearch"]},e.updateLocalStorage=function(e){var t=[],c=localStorage.getItem("musicSearch.recentSearch");c&&(t=JSON.parse(c)),0===t.length&&t.push(e),-1===t.indexOf(e)?t.push(e):(t.splice(t.indexOf(e),1),t.push(e)),t.length>5&&t.splice(0,1),localStorage.setItem("musicSearch.recentSearch",JSON.stringify(t))}}])}(),function(){"use strict";angular.module("musicSearch.services.search",[]).service("Search",["$http","$location","$q","Constants","LocalStorage",function(e,t,c,n,r){var o=this;o.fetchResults=function(t,o,a){var s=c.defer();o/=2;var l="q="+encodeURIComponent(t)+"&type=album,artist&limit="+o+"&offset="+a,i=n.APIURL+n.Search+"?"+l;return e.get(i).success(function(e,c,n,o){s.resolve(e),r.updateLocalStorage(t)}).error(function(e,t,c,n){s.reject(e)}),s.promise},o.Album=function(t){var n=c.defer();return e.get(t).success(function(e,t,c,r){n.resolve(e)}).error(function(e,t,c,r){n.reject(e)}),n.promise},o.Albums=function(t,r,o){var a,s=c.defer();return a=r?o:n.APIURL+n.ArtistById+t+"/albums?offset=0&limit=20",e.get(a).success(function(e,t,c,n){s.resolve(e)}).error(function(e,t,c,n){s.reject(e)}),s.promise},o.Tracks=function(t,r,o){var a,s=c.defer();return a=r?o:n.APIURL+n.AlbumById+t+"/tracks?offset=0&limit=20",e.get(a).success(function(e,t,c,n){s.resolve(e)}).error(function(e,t,c,n){s.reject(e)}),s.promise}}])}(),function(){"use strict";angular.module("musicSearch.directive.contentCard",[]).directive("contentCard",[function(){return{scope:{object:"="},restrict:"AE",replace:"true",templateUrl:"html/directive-templates/content-card.html",link:function(e,t,c){setTimeout(function(){t[0].classList.add("animated")},0)},controller:"contentCardCtrl"}}]).controller("contentCardCtrl",["$scope",function(e){e.getLabel=function(e){return"album"===e?"Tracks":"artist"===e?"Albums":void 0},e.openModal=function(e,t){var c=document.getElementById(e),n=new CustomEvent("open-modal",{detail:t});c.dispatchEvent(n)}}])}(),function(){"use strict";angular.module("musicSearch.directive.modalBox",[]).directive("modalBox",["Search",function(e){return{restrict:"EA",transclude:!0,scope:{},templateUrl:"html/directive-templates/modal-box.html",link:function(e,t,c){t[0].addEventListener("open-modal",function(t){e.modalState="loaded",document.addEventListener("keydown",n,!0),e.openModalLogic(t)}),t[0].addEventListener("close-modal",function(t){e.modalState="hidden",document.removeEventListener("keydown",n,!0),e.closeModalLogic(t)});var n=function(t){t.ctrlKey||t.metaKey||27===t.which&&(e.closeModal(),e.$$phase||e.$apply())};e.closeModal=function(){var e=new CustomEvent("close-modal",{});t[0].dispatchEvent(e)}},controller:"modalCtrl"}}]).controller("modalCtrl",["$scope","Search",function(e,t){e.loadingItem=!1,e.contents={},e.openModalLogic=function(t,r,o){e.loadingItem=!0,document.body.style.overflow="hidden",e.contents=t.detail,e.contents.items=[],"artist"===t.detail.type?c(t):"album"===t.detail.type&&n(t)},e.getTrackTime=function(e){var t=Math.ceil(e/1e3),c=t%60;return c=c<10?"0"+c:c,Math.floor(t/60)+":"+c},e.closeModalLogic=function(e){document.body.style.overflow="visible"};var c=function(n,r,o){t.Albums(n.detail.id,r,o).then(function(r){e.contents.items=e.contents.items.concat(r.items),null!==r.next?c(n,!0,r.next):(e.loadingItem=!1,angular.forEach(e.contents.items,function(c,n){t.Album(c.href).then(function(t){e.contents.items[n].release_day=t.release_date.split("-")[0]}).catch(function(e){console.log(e)})}))}).catch(function(t){console.log(t),e.loadingItem=!1})},n=function(c,r,o){t.Tracks(c.detail.id,r,o).then(function(t){e.contents.items=e.contents.items.concat(t.items),null!==t.next?n(c,!0,t.next):e.loadingItem=!1}).catch(function(t){console.log(t),e.loadingItem=!1})}}])}(),function(){"use strict";angular.module("musicSearch.controller.main",[]).controller("mainCtrl",["$scope","$rootScope","Helper","Search",function(e,t,c,n){e.controllerReady=!0,e.search={query:"",canLoadMore:!1,loading:!1},e.screenState="initial";var r=0;e.getSearchResults=function(){r=0,e.search.canLoadMore=!1,e.screenState="results",e.results=[],o(e.search.query)},e.loadMoreResults=function(){o(e.search.query)};var o=function(c){0===c.length?(e.search.canLoadMore=!1,e.screenState="initial"):(e.search.loading=!0,n.fetchResults(c,20,r).then(function(c){e.search.loading=!1,e.screenState="results",a(c),t.$broadcast("load-complete")}).catch(function(t){e.screenState="error",console.log(t),e.search.loading=!1}))},a=function(t){var n=null!==t.albums.next,r=null!==t.artists.next;if(t.albums.total+t.artists.total===0)e.screenState="no-results";else{var o=c.shuffleArray(t.albums.items,t.artists.items);e.results=e.results.concat(o),e.search.canLoadMore=!0,n||r?(s(),o.length<20&&l(t,o)):e.search.canLoadMore=!1}},s=function(){r+=10},l=function(t,o){var a=20-o.length,s=e.search.query;e.search.loading=!0,n.fetchResults(s,2*a,r).then(function(t){var n=c.shuffleArray(t.albums.items,t.artists.items);e.results=e.results.concat(n),r+=a,e.search.loading=!1}).catch(function(t){e.screenState="error",e.search.loading=!1,console.log(t)})}}])}(),function(){"use strict";angular.module("musicSearch.controller.search",[]).controller("searchCtrl",["$scope","LocalStorage",function(e,t){e.setRecentSearches=function(){e.recentSearches=t.getLocalStorage().slice().reverse()},e.$on("load-complete",function(t,c){e.setRecentSearches()}),e.deleteRecentSearches=function(c){"click"===c.type?(c.preventDefault(),t.deleteLocalStorage()):13===c.which&&t.deleteLocalStorage(),e.setRecentSearches(),e.hideRecentSearchModal()},e.getSearchResultsOnEnter=function(t){e.hideRecentSearchModal(),13===t.which&&(t.preventDefault(),e.getSearchResults())},e.showRecentSearchModal=function(){e.recentSearches.length>0&&(e.showRecentSearch=!0)},e.hideRecentSearchModal=function(){e.showRecentSearch=!1},e.hideRecentSearchModalifEmpty=function(){0===e.recentSearches.length&&e.hideRecentSearchModal()},e.getSearchResultsOfSearch=function(t,c){e.search.query=c,"click"===t.type?(t.preventDefault(),e.getSearchResults(),e.hideRecentSearchModal()):e.getSearchResultsOnEnter(t)}}])}();